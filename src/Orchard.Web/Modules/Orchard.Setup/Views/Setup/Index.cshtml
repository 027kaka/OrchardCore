@using Orchard.Setup.Controllers
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer T
@model Orchard.Setup.ViewModels.SetupViewModel
@{
    var groupedRecipes = Model.Recipes.Where(x => x.Categories.Any()).GroupBy(x => x.Categories);
    var unspecifiedCategoryRecipes = Model.Recipes.Where(x => !x.Categories.Any()).ToList();
    var groupCount = groupedRecipes.Count() + unspecifiedCategoryRecipes.Count;
}

<form asp-action="Index">

    <div class="jumbotron">
        <h1>SETUP</h1>
        <p class="lead">@T["Please answer a few questions to configure your site."]</p>
    </div>

    <fieldset class="form-group" asp-validation-class-for="SiteName">
        <div class="row col-md-6">
            <label asp-for="SiteName">@T["What is the name of your site?"]</label>
            <span asp-validation-for="SiteName" class="text-danger">@T["This site name is required."]</span>
            <input asp-for="SiteName" class="form-control" autofocus />
            <span class="text-muted form-text small">@T["This is used as the default title of your pages."]</span>
        </div>
    </fieldset>

    <h6>
        Database
        <span class="text-muted form-text small">@T["The database is used to store the site's configuration and its contents. You can specify a custom table prefix if you intend to reuse the same database for multiple sites."]</span>
    </h6>
    <div class="row">
        <div class="form-group col-md-6">
            <label asp-for="DatabaseProvider">@T["What type of database to use?"]</label>
            <select asp-for="DatabaseProvider" class="form-control">
                @foreach (var provider in Model.DatabaseProviders)
                {
                <option value="@provider.Value" data-connection-string="@provider.HasConnectionString">@provider.Name</option>
                }
            </select>
        </div>
        <div class="form-group col-md-6" asp-validation-class-for="TablePrefix">
            <label asp-for="TablePrefix">@T["Table Prefix"]</label>
            <span asp-validation-for="TablePrefix" class="text-danger"></span>
            <input asp-for="TablePrefix" class="form-control" />
        </div>
    </div>

    <fieldset class="row connectionString" asp-validation-class-for="ConnectionString">
        <div class="form-group col-xs-12">
            <label asp-for="ConnectionString">@T["Connection string"]</label>
            <span asp-validation-for="ConnectionString" class="text-danger"></span>
            <input asp-for="ConnectionString" class="form-control" />
            <span class="text-muted form-text small">@T["The connection string to your database instance. e.g., Data Source=<em>localhost</em>;Initial Catalog=<em>Orchard</em>;User Id=<em>userid</em>;Password=<em>password</em>"]</span>
        </div>
    </fieldset>

    <h6>
        Super User
        <span class="text-muted form-text small">@T["The super user has all the rights. It should be used only during Setup and for disaster recovery."]</span>
    </h6>
    <div class="row">
        <div class="form-group col-md-6" asp-validation-class-for="AdminUserName">
            <label asp-for="AdminUserName">@T["User name"]</label>
            <span asp-validation-for="AdminUserName" class="text-danger">@T["The user name is required."]</span>
            <input asp-for="AdminUserName" class="form-control" />
        </div>
        <div class="form-group col-md-6" asp-validation-class-for="AdminEmail">
            <label for="AdminEmail">@T["Email"]</label>
            <span asp-validation-for="AdminEmail" class="text-danger">@T["The email is invalid."]</span>
            <input asp-for="AdminEmail" class="form-control" type="email"/>
        </div>
    </div>

    <div class="row">
        <div class="form-group col-md-6" asp-validation-class-for="Password">
            <label asp-for="Password">@T["Password"]</label>
            <span asp-validation-for="Password" class="text-danger"></span>
            <input asp-for="Password" type="password" class="form-control" />
        </div>

        <div class="form-group col-md-6" asp-validation-class-for="PasswordConfirmation">
            <label asp-for="PasswordConfirmation">@T["Password Confirmation"]</label>
            <span asp-validation-for="PasswordConfirmation" class="text-danger"></span>
            <input asp-for="PasswordConfirmation" type="password" class="form-control" />
        </div>
    </div>

    <h6>
        Recipe
        <span class="text-muted form-text small">@T["Orchard Recipes allow you to setup your site with additional pre-configured options, features and settings out of the box."]</span>
    </h6>
    <div class="row">
        <div class="form-group col-md-6" asp-validation-class-for="RecipeName">
            <select asp-for="RecipeName" class="form-control">
                @foreach (var recipeGroup in groupedRecipes.OrderBy(x => x.Key))
                {
                    if (groupCount > 1)
                    {
                        <optgroup label="@recipeGroup.Key"></optgroup>
                    }
                    foreach (var recipe in recipeGroup.OrderBy(x => x.Name))
                    {
                        <option value="@recipe.Name" selected="@(Model.RecipeName == null && recipe.Name == "Default")">@recipe.Name</option>
                    }
                }
                @if (unspecifiedCategoryRecipes.Count() > 0)
                {
                    if (groupCount > 1)
                    {
                        <optgroup label="Unspecified"></optgroup>
                    }
                    foreach (var recipe in unspecifiedCategoryRecipes.OrderBy(x => x.Name))
                    {
                        <option value="@recipe.Name" selected="@(Model.RecipeName == null && recipe.Name == "Default")">@recipe.Name</option>
                    }
                }
            </select>
        </div>
    </div>

    <fieldset>
        <div class="form-group">
            <button class="btn btn-primary" type="submit">@T["Finish Setup"]</button>
        </div>
    </fieldset>
</form>
